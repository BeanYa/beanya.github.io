---
title: Centos下防火墙+ss多端口脚本
date: 2019-02-10 02:40:31
categories:
- Linux
tags:
- Linux
- Note
---
# 目的

开启SS之后，添加多端口再去打开防火墙比较麻烦，做了一个一键脚本。

## 代码

``` bash
#!/bin/sh
echo -e -n "add: {\"server_port\": $1, \"password\":\"$2\"}" > /dev/udp/127.0.0.1/6001

tcp=$(firewall-cmd --zone=public --add-port=$1/tcp --permanent)
echo "TCP端口 $1 开放操作: $tcp"

udp=$(firewall-cmd --zone=public --add-port=$1/udp --permanent)
echo "udp端口 $1 开放操作: $udp"

rel=$(firewall-cmd --reload)
echo "防火墙重启操作: $rel"

get_ip(){
    local IP=$( ip addr | egrep -o '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | egrep -v "^192\.168|^172\.1[6-9]\.|^172\.2[0-9]\.|^172\.3[0-2]\.|^10\.|^127\.|^255\.|^0\." | head -n 1 )
    [ -z ${IP} ] && IP=$( wget -qO- -t1 -T2 ipv4.icanhazip.com )
    [ -z ${IP} ] && IP=$( wget -qO- -t1 -T2 ipinfo.io/ip )
    echo ${IP}
}

echo "IP:$(get_ip) 端口:$1 密码:$2"

#base64链接

link=$( base64 <<< "aes-256-cfb:$2@$(get_ip):$1" )

echo "ss://$link"
```