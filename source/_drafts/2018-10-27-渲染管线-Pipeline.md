---
title: 渲染管线-Pipeline
date: 2018-10-27 15:54:43
categories:
- Unity
tags:
- Pipeline
- Shader
- Graphic
---
# 渲染管线

## 概念介绍

渲染管线(Render Pipeline) 也即渲染流水线。

渲染管线的工作任务在于从一个三维场景出发，生成(或渲染)成一张二维图像。即计算机从一系列的顶点数据，纹理等信息出发，把信息转换成一张人眼可见的图像，这个过程由CPU和GPU共同完成

百度百科的定义为显示芯片内部处理图形信号相互独立的并行处理单元。此处指概念上的渲染管线，与GPU上的渲染管线不同。

DX10为了提高渲染速度，改良渲染架构，不再使用渲染管线的概念。

>在DX10的统一渲染架构中，渲染管线、顶点着色器等不复存在。所谓统一渲染架构，大家可以理解为将Vertex Shader（顶点着色器单元）、Pixel Pipelines（像素渲染管线）统一被Stream Processors（流处理器）所取代。此时，显卡中的GPU将不会开辟独立的渲染管线，而是所有的运算单元都可以任意处理任何一种Shader运算。这使得GPU的利用率更加高，也避免了传统架构中由于资源分配不合理引起的资源浪费现象。 最新的DX11也是采用流处理器的统一渲染架构。


《Real-Time Rendering》一书中将渲染流程分成三阶段：

- 应用阶段(Application Stage)
- 几何阶段(Geometry Stage)
- 光栅化阶段(Rasterizer Stage)

每个阶段本身也是一个流水线系统，即包含了子流水线阶段。

## 应用阶段(Application Stage)

应用阶段顾名思义由应用主导，开发者对应用阶段的流水线化有绝对的控制权。

### 应用阶段的主要任务
1. 准备场景数据
    - 相机的位置
    - 视锥体的信息
    - 场景包含了哪些模型
    - 光源信息
    
2. 为了优化渲染性能，进行粗粒度剔除剔除不可见的物体。

3. 设置模型的渲染状态，渲染状态包括但不限于：
    - 模型使用的材质(漫反射颜色，高光反射的颜色)
    - 模型使用的纹理
    - 所用的Shader

最后一个阶段的任务是出书渲染所需的几何信息，即渲染图元(Rendering primitives)。

渲染图元可以是点，线，三角面等

### 应用阶段的输出

应用阶段输出一系列顶点的数据即渲染图元，并递交给几何阶段。

## 几何阶段(Geometry Stage)

处理绘制几何相关的任务，决定绘制图元的种类和绘制方式。

在这个阶段里对每个图元进行逐顶点，逐多边形的操作。

### 几何阶段的重要任务

讲应用阶段传递的渲染图元进行坐标变换，变换到屏幕空间中，最后交由光栅器处理。

### 几何阶段的输出

对渲染图元进行多步处理，输出屏幕空间的二维顶点坐标，每个顶点对应的深度值，着色等信息。

## 光栅化阶段(Rasterizer Stage)
